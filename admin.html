<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>PADEL ADMIN ‚Äî Control Panel</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öôÔ∏è</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root{--bg:#06090f;--glass:rgba(12,18,40,0.7);--cyan:#00e5ff;--purple:#b44aff;--green:#00ff88;--pink:#ff2d78;--text:#e4eaf4;--text2:#7889a8;--muted:#3a4860;--border:rgba(0,229,255,0.12);--bsub:rgba(255,255,255,0.05);--fd:'Orbitron',monospace;--fb:'Rajdhani',sans-serif;--fm:'Share Tech Mono',monospace;--r:10px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px}
body{font-family:var(--fb);background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased;padding-bottom:env(safe-area-inset-bottom,20px)}
body::before{content:'';position:fixed;inset:0;background:linear-gradient(rgba(0,229,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.02) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}

/* LOGIN */
.login-overlay{position:fixed;inset:0;z-index:9999;background:rgba(6,9,15,0.98);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:center}
.login-overlay.hidden{display:none}
.login-box{background:var(--glass);border:1px solid var(--border);border-radius:16px;padding:32px;width:320px;max-width:90vw;text-align:center}
.login-icon{width:60px;height:60px;margin:0 auto 16px;border-radius:14px;background:linear-gradient(135deg,var(--cyan),var(--purple));display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 0 30px rgba(0,229,255,0.3)}
.login-title{font-family:var(--fd);font-size:0.8rem;letter-spacing:3px;text-transform:uppercase;color:var(--cyan);margin-bottom:6px}
.login-sub{font-size:0.85rem;color:var(--text2);margin-bottom:20px}
.login-input{width:100%;padding:14px 16px;border-radius:8px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,229,255,0.15);color:var(--text);font-family:var(--fm);font-size:1rem;text-align:center;outline:none;margin-bottom:14px;transition:border-color 0.3s}
.login-input:focus{border-color:var(--cyan)}
.login-input::placeholder{color:var(--muted)}
.login-btn{width:100%;padding:14px;border-radius:8px;border:none;background:linear-gradient(135deg,var(--cyan),var(--purple));color:#fff;font-family:var(--fd);font-size:0.7rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;cursor:pointer;transition:transform 0.2s}
.login-btn:active{transform:scale(0.97)}
.login-error{color:var(--pink);font-size:0.8rem;margin-top:10px;font-family:var(--fm);min-height:1.2em}

/* HEADER */
.admin-header{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(6,9,15,0.95);backdrop-filter:blur(16px);border-bottom:1px solid var(--border)}
.admin-title{font-family:var(--fd);font-size:0.65rem;letter-spacing:3px;text-transform:uppercase;color:var(--cyan)}
.admin-status{font-family:var(--fm);font-size:0.6rem;color:var(--text2);display:flex;align-items:center;gap:6px}
.status-dot{width:6px;height:6px;border-radius:50%;background:var(--green);transition:background 0.3s}
.status-dot.saving{background:var(--cyan);animation:pulse 0.6s infinite}
.status-dot.error{background:var(--pink)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
.logout-btn{padding:6px 12px;border-radius:6px;border:1px solid rgba(255,45,120,0.3);background:rgba(255,45,120,0.08);color:var(--pink);font-family:var(--fd);font-size:0.5rem;letter-spacing:2px;cursor:pointer}

/* BODY */
.admin-body{max-width:600px;margin:0 auto;padding:16px;position:relative;z-index:1}

/* TABS */
.admin-tabs{display:flex;gap:4px;margin-bottom:16px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.admin-tab{font-family:var(--fd);font-size:0.5rem;letter-spacing:2px;text-transform:uppercase;padding:10px 14px;border-radius:8px;border:1px solid transparent;background:transparent;color:var(--text2);cursor:pointer;white-space:nowrap;transition:all 0.3s;flex-shrink:0}
.admin-tab.active{color:var(--cyan);border-color:rgba(0,229,255,0.3);background:rgba(0,229,255,0.07)}

.tab-content{display:none}.tab-content.active{display:block}

/* CARDS */
.a-card{background:var(--glass);border:1px solid var(--border);border-radius:var(--r);margin-bottom:14px;overflow:hidden}
.a-card-head{padding:10px 14px;background:rgba(0,0,0,0.2);border-bottom:1px solid var(--bsub);font-family:var(--fd);font-size:0.5rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--cyan)}
.a-card-body{padding:14px}

/* FORM */
.field{margin-bottom:12px}
.field-label{display:block;font-family:var(--fd);font-size:0.45rem;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px}
.field-input{width:100%;padding:12px 14px;border-radius:8px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,229,255,0.12);color:var(--text);font-family:var(--fb);font-size:1rem;font-weight:600;outline:none;transition:border-color 0.3s;-webkit-appearance:none}
.field-input:focus{border-color:var(--cyan)}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* SCORE CONTROLS */
.score-control{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--bsub)}
.score-control:last-child{border-bottom:none}
.sc-label{font-family:var(--fd);font-size:0.5rem;letter-spacing:2px;color:var(--text2);text-transform:uppercase;min-width:50px}
.sc-team-btns{display:flex;align-items:center;gap:6px}
.sc-value{font-family:var(--fm);font-size:1.4rem;font-weight:700;min-width:44px;text-align:center;color:var(--text);background:rgba(0,0,0,0.3);border-radius:6px;padding:6px 4px;border:1px solid var(--bsub)}
.sc-btn{width:48px;height:48px;border-radius:10px;border:1px solid rgba(0,229,255,0.2);background:rgba(0,229,255,0.06);color:var(--cyan);font-family:var(--fd);font-size:1.2rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.15s;user-select:none;-webkit-tap-highlight-color:transparent}
.sc-btn:active{transform:scale(0.92);background:rgba(0,229,255,0.15)}
.sc-btn.minus{border-color:rgba(255,45,120,0.2);background:rgba(255,45,120,0.06);color:var(--pink)}
.sc-btn.minus:active{background:rgba(255,45,120,0.15)}

/* ACTION BTNS */
.action-btn{width:100%;padding:16px;border-radius:10px;border:none;font-family:var(--fd);font-size:0.6rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;cursor:pointer;transition:all 0.2s;margin-bottom:10px;-webkit-tap-highlight-color:transparent}
.action-btn:active{transform:scale(0.97)}
.btn-primary{background:linear-gradient(135deg,var(--cyan),var(--purple));color:#fff;box-shadow:0 4px 20px rgba(0,229,255,0.2)}
.btn-danger{background:rgba(255,45,120,0.1);color:var(--pink);border:1px solid rgba(255,45,120,0.3)}
.btn-success{background:rgba(0,255,136,0.08);color:var(--green);border:1px solid rgba(0,255,136,0.25)}
.btn-secondary{background:rgba(0,229,255,0.06);color:var(--cyan);border:1px solid rgba(0,229,255,0.2)}

/* STANDINGS EDITOR */
.se-header{display:grid;grid-template-columns:1fr 36px 36px 36px 44px 44px 36px;gap:3px;padding:6px 0;border-bottom:1px solid var(--border)}
.se-header span{font-family:var(--fd);font-size:0.38rem;letter-spacing:1px;text-transform:uppercase;color:var(--muted);text-align:center}
.se-header span:first-child{text-align:left}
.standings-edit-row{display:grid;grid-template-columns:1fr 36px 36px 36px 44px 44px 36px;gap:3px;align-items:center;padding:5px 0;border-bottom:1px solid var(--bsub)}
.se-input{padding:7px 4px;border-radius:6px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,229,255,0.08);color:var(--text);font-family:var(--fm);font-size:0.7rem;text-align:center;outline:none;width:100%;-webkit-appearance:none}
.se-input:focus{border-color:var(--cyan)}
.se-input.name-input{text-align:left;font-family:var(--fb);font-weight:600;font-size:0.78rem}
.se-check{accent-color:var(--cyan);width:18px;height:18px;cursor:pointer}

/* TOAST */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);padding:12px 24px;border-radius:10px;font-family:var(--fm);font-size:0.8rem;z-index:9999;transition:transform 0.3s ease;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.success{background:rgba(0,255,136,0.15);color:var(--green);border:1px solid rgba(0,255,136,0.3)}
.toast.error{background:rgba(255,45,120,0.15);color:var(--pink);border:1px solid rgba(255,45,120,0.3)}

@media(max-width:640px){
  .admin-body{padding:12px 10px}
  .sc-btn{width:44px;height:44px;font-size:1rem}
  .sc-value{font-size:1.2rem;min-width:38px}
  .standings-edit-row,.se-header{grid-template-columns:1fr 30px 30px 30px 38px 38px 30px;gap:2px}
  .se-input{padding:5px 2px;font-size:0.6rem}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-box">
    <div class="login-icon">üîê</div>
    <div class="login-title">Admin Access</div>
    <div class="login-sub">Enter password to control the broadcast</div>
    <input class="login-input" type="password" id="loginPassword" placeholder="Password" autocomplete="off">
    <button class="login-btn" onclick="attemptLogin()">ENTER</button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

<!-- HEADER -->
<div class="admin-header" id="adminHeader" style="display:none">
  <div class="admin-title">‚öô CONTROL</div>
  <div class="admin-status"><div class="status-dot" id="statusDot"></div><span id="statusText">Ready</span></div>
  <button class="logout-btn" onclick="logout()">LOGOUT</button>
</div>

<!-- BODY -->
<div class="admin-body" id="adminBody" style="display:none">

  <div class="admin-tabs">
    <button class="admin-tab active" onclick="switchAdminTab('score',this)">‚ö° Score</button>
    <button class="admin-tab" onclick="switchAdminTab('match',this)">üìã Match</button>
    <button class="admin-tab" onclick="switchAdminTab('standings',this)">üèÜ Table</button>
    <button class="admin-tab" onclick="switchAdminTab('stream',this)">üì∫ Stream</button>
  </div>

  <!-- ======== SCORE TAB ======== -->
  <div class="tab-content active" id="tab-score">
    <div class="a-card">
      <div class="a-card-head">Match Status</div>
      <div class="a-card-body" style="display:flex;gap:10px">
        <button class="action-btn btn-success" style="flex:1;margin:0" onclick="setMatchLive(true)">‚ñ∂ GO LIVE</button>
        <button class="action-btn btn-danger" style="flex:1;margin:0" onclick="setMatchLive(false)">‚ñ† END</button>
      </div>
    </div>

    <div class="a-card">
      <div class="a-card-head">Points (Current Game)</div>
      <div class="a-card-body">
        <div class="score-control">
          <span class="sc-label" id="ptLabelA">Team A</span>
          <div class="sc-team-btns">
            <button class="sc-btn minus" onclick="adjScore('PointsA',-1)">‚àí</button>
            <div class="sc-value" id="adm_PointsA">0</div>
            <button class="sc-btn" onclick="adjScore('PointsA',1)">+</button>
          </div>
        </div>
        <div class="score-control">
          <span class="sc-label" id="ptLabelB">Team B</span>
          <div class="sc-team-btns">
            <button class="sc-btn minus" onclick="adjScore('PointsB',-1)">‚àí</button>
            <div class="sc-value" id="adm_PointsB">0</div>
            <button class="sc-btn" onclick="adjScore('PointsB',1)">+</button>
          </div>
        </div>
        <button class="action-btn btn-secondary" style="margin-top:10px" onclick="resetPoints()">‚Üª RESET POINTS</button>
      </div>
    </div>

    <div class="a-card">
      <div class="a-card-head">Games ‚Äî <span id="currentSetLabel">Set 1</span></div>
      <div class="a-card-body">
        <div style="display:flex;gap:6px;margin-bottom:12px">
          <button class="action-btn btn-secondary" style="flex:1;margin:0;padding:12px" onclick="selectSet(1)" id="sBtn1">SET 1</button>
          <button class="action-btn btn-secondary" style="flex:1;margin:0;padding:12px" onclick="selectSet(2)" id="sBtn2">SET 2</button>
          <button class="action-btn btn-secondary" style="flex:1;margin:0;padding:12px" onclick="selectSet(3)" id="sBtn3">SET 3</button>
        </div>
        <div class="score-control">
          <span class="sc-label" id="gmLabelA">Team A</span>
          <div class="sc-team-btns">
            <button class="sc-btn minus" onclick="adjGame('A',-1)">‚àí</button>
            <div class="sc-value" id="adm_GameA">0</div>
            <button class="sc-btn" onclick="adjGame('A',1)">+</button>
          </div>
        </div>
        <div class="score-control">
          <span class="sc-label" id="gmLabelB">Team B</span>
          <div class="sc-team-btns">
            <button class="sc-btn minus" onclick="adjGame('B',-1)">‚àí</button>
            <div class="sc-value" id="adm_GameB">0</div>
            <button class="sc-btn" onclick="adjGame('B',1)">+</button>
          </div>
        </div>
      </div>
    </div>

    <div class="a-card">
      <div class="a-card-head">Quick Actions</div>
      <div class="a-card-body">
        <button class="action-btn btn-danger" onclick="resetMatch()">üóë RESET ENTIRE MATCH</button>
      </div>
    </div>
  </div>

  <!-- ======== MATCH TAB ======== -->
  <div class="tab-content" id="tab-match">
    <div class="a-card">
      <div class="a-card-head">Team A</div>
      <div class="a-card-body">
        <div class="field">
          <label class="field-label">Team Name</label>
          <input class="field-input" id="inp_TeamA" placeholder="e.g. Thunder Smash">
        </div>
        <div class="field">
          <label class="field-label">Short Name (3 letters)</label>
          <input class="field-input" id="inp_TeamAShort" placeholder="e.g. THU" maxlength="4">
        </div>
        <div class="field">
          <label class="field-label">Players</label>
          <input class="field-input" id="inp_PlayersA" placeholder="e.g. Lebron ‚Ä¢ Gal√°n">
        </div>
      </div>
    </div>
    <div class="a-card">
      <div class="a-card-head">Team B</div>
      <div class="a-card-body">
        <div class="field">
          <label class="field-label">Team Name</label>
          <input class="field-input" id="inp_TeamB" placeholder="e.g. Neon Volley">
        </div>
        <div class="field">
          <label class="field-label">Short Name (3 letters)</label>
          <input class="field-input" id="inp_TeamBShort" placeholder="e.g. NEO" maxlength="4">
        </div>
        <div class="field">
          <label class="field-label">Players</label>
          <input class="field-input" id="inp_PlayersB" placeholder="e.g. Coello ‚Ä¢ Tapia">
        </div>
      </div>
    </div>
    <div class="a-card">
      <div class="a-card-head">Match Details</div>
      <div class="a-card-body">
        <div class="field">
          <label class="field-label">Tournament</label>
          <input class="field-input" id="inp_Tournament" placeholder="e.g. Madrid Open 2026">
        </div>
        <div class="field-row">
          <div class="field">
            <label class="field-label">Round</label>
            <input class="field-input" id="inp_Round" placeholder="Quarter Final">
          </div>
          <div class="field">
            <label class="field-label">Round Short</label>
            <input class="field-input" id="inp_RoundShort" placeholder="QF" maxlength="4">
          </div>
        </div>
        <div class="field">
          <label class="field-label">Court</label>
          <input class="field-input" id="inp_Court" placeholder="Center Court">
        </div>
      </div>
    </div>
    <button class="action-btn btn-primary" onclick="saveMatchInfo()">üíæ SAVE MATCH INFO</button>
  </div>

  <!-- ======== STANDINGS TAB ======== -->
  <div class="tab-content" id="tab-standings">
    <div class="a-card">
      <div class="a-card-head">League Standings Editor</div>
      <div class="a-card-body" style="padding:8px;overflow-x:auto">
        <div class="se-header">
          <span>Team</span><span>MP</span><span>W</span><span>L</span><span>PTS</span><span>SD</span><span>üéÆ</span>
        </div>
        <div id="standingsEditor"></div>
      </div>
    </div>
    <button class="action-btn btn-primary" onclick="saveStandings()">üíæ SAVE STANDINGS</button>
    <button class="action-btn btn-secondary" onclick="addStandingsRow()">+ ADD TEAM</button>
  </div>

  <!-- ======== STREAM TAB ======== -->
  <div class="tab-content" id="tab-stream">
    <div class="a-card">
      <div class="a-card-head">YouTube Stream URL</div>
      <div class="a-card-body">
        <div class="field">
          <label class="field-label">Embed URL</label>
          <input class="field-input" id="inp_StreamURL" placeholder="https://www.youtube.com/embed/XXXXX">
        </div>
        <p style="font-size:0.75rem;color:var(--text2);margin-bottom:12px">
          Use the embed format: https://www.youtube.com/embed/VIDEO_ID<br>
          Add ?autoplay=1&mute=1 for auto-start.
        </p>
      </div>
    </div>
    <button class="action-btn btn-primary" onclick="saveStreamURL()">üíæ SAVE STREAM URL</button>
  </div>

</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* ============================================================
   üîß CONFIGURATION
   ============================================================ */
const ADMIN_CFG = {
  /* Password (change this!) */
  PASSWORD: 'padel2026',

  /* Google Sheets Config */
  SHEET_ID: 'https://docs.google.com/spreadsheets/d/1WfKkccUAvyMHOcF-zMXh2kKUTsA1KXwMTwoE7-P05sg/edit?gid=1714615045#gid=1714615045',
  API_KEY: 'AIzaSyADRJs4m2Nbn99R0dPBpzp0a7KSeGCRSeo',

  /* Google Apps Script Web App URL (for WRITING data) */
  APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxas0cWLNPqy3Jkid8BGp4mXFQ2iPqwPnFETaI66x1JuXiyXU1h6iLfQEl3SUJ4La-Rqw/exec',

  /* Sheet tab names */
  MATCH_SHEET: 'Match',
  STANDINGS_SHEET: 'Standings',
  SCHEDULE_SHEET: 'Schedule',

  /* Padel point values */
  PADEL_POINTS: ['0', '15', '30', '40', 'AD'],
};

/* ============================================================
   STATE
   ============================================================ */
let matchData = {};
let standingsData = [];
let currentSet = 1;
let isLoggedIn = false;
let saveLock = false;

/* ============================================================
   LOGIN
   ============================================================ */
document.getElementById('loginPassword').addEventListener('keydown', e => { if(e.key==='Enter') attemptLogin(); });

function attemptLogin() {
  const pw = document.getElementById('loginPassword').value;
  if (pw === ADMIN_CFG.PASSWORD) {
    isLoggedIn = true;
    document.getElementById('loginOverlay').classList.add('hidden');
    document.getElementById('adminHeader').style.display = 'flex';
    document.getElementById('adminBody').style.display = 'block';
    sessionStorage.setItem('padel_admin', '1');
    loadData();
  } else {
    document.getElementById('loginError').textContent = 'Wrong password. Try again.';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginPassword').focus();
  }
}

function logout() {
  sessionStorage.removeItem('padel_admin');
  location.reload();
}

// Auto-login from session
if (sessionStorage.getItem('padel_admin') === '1') {
  isLoggedIn = true;
  document.getElementById('loginOverlay').classList.add('hidden');
  document.getElementById('adminHeader').style.display = 'flex';
  document.getElementById('adminBody').style.display = 'block';
  document.addEventListener('DOMContentLoaded', loadData);
}

/* ============================================================
   TABS
   ============================================================ */
function switchAdminTab(tab, btn) {
  document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  if (btn) btn.classList.add('active');
  document.getElementById('tab-' + tab).classList.add('active');
}

/* ============================================================
   GOOGLE SHEETS ‚Äî READ
   ============================================================ */
function sheetReadURL(name) {
  return `https://sheets.googleapis.com/v4/spreadsheets/${ADMIN_CFG.SHEET_ID}/values/${encodeURIComponent(name)}?key=${ADMIN_CFG.API_KEY}`;
}

async function readSheet(name) {
  const r = await fetch(sheetReadURL(name));
  if (!r.ok) throw new Error(`Read failed: ${r.status}`);
  return (await r.json()).values || [];
}

/* ============================================================
   GOOGLE SHEETS ‚Äî WRITE (via Apps Script)
   ============================================================ */
async function writeSheet(sheetName, data) {
  if (saveLock) return;
  saveLock = true;
  setStatus('saving', 'Saving‚Ä¶');

  try {
    const resp = await fetch(ADMIN_CFG.APPS_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ sheet: sheetName, data: data }),
    });

    if (!resp.ok) throw new Error('Write failed');
    const result = await resp.json();
    if (result.status === 'ok') {
      setStatus('ok', 'Saved');
      showToast('Saved successfully!', 'success');
    } else {
      throw new Error(result.message || 'Unknown error');
    }
  } catch(e) {
    console.error('Write error:', e);
    setStatus('error', 'Error');
    showToast('Save failed: ' + e.message, 'error');
  } finally {
    saveLock = false;
  }
}

/* ============================================================
   LOAD DATA
   ============================================================ */
async function loadData() {
  setStatus('saving', 'Loading‚Ä¶');
  try {
    const [matchRows, standingsRows] = await Promise.all([
      readSheet(ADMIN_CFG.MATCH_SHEET),
      readSheet(ADMIN_CFG.STANDINGS_SHEET),
    ]);

    // Parse match
    matchData = {};
    matchRows.forEach(r => { if(r[0]) matchData[r[0]] = r[1] || ''; });

    // Fill inputs
    const fields = ['TeamA','TeamAShort','PlayersA','TeamB','TeamBShort','PlayersB','Tournament','Round','RoundShort','Court','StreamURL'];
    fields.forEach(f => {
      const inp = document.getElementById('inp_' + f);
      if (inp && matchData[f]) inp.value = matchData[f];
    });

    // Points
    updatePointsDisplay();
    updateGamesDisplay();
    updateTeamLabels();

    // Standings
    if (standingsRows.length > 1) {
      standingsData = standingsRows.slice(1).map(r => ({
        name: r[0]||'', played: r[1]||'0', wins: r[2]||'0', losses: r[3]||'0',
        points: r[4]||'0', setDiff: r[5]||'0', playing: (r[6]||'').toUpperCase()==='TRUE'||r[6]==='1',
      }));
    } else {
      standingsData = [];
    }
    renderStandingsEditor();

    setStatus('ok', 'Loaded');
  } catch(e) {
    console.error('Load error:', e);
    setStatus('error', 'Load failed');
    showToast('Could not load data. Check Sheet ID and API key.', 'error');
    // Load defaults
    loadDefaults();
  }
}

function loadDefaults() {
  matchData = {
    TeamA:'THUNDER SMASH', TeamAShort:'THU', PlayersA:'Lebron ‚Ä¢ Gal√°n',
    TeamB:'NEON VOLLEY', TeamBShort:'NEO', PlayersB:'Coello ‚Ä¢ Tapia',
    Tournament:'Madrid Open 2026', Round:'Quarter Final', RoundShort:'QF', Court:'Center Court',
    Set1A:'0', Set1B:'0', Set2A:'-', Set2B:'-', Set3A:'-', Set3B:'-',
    PointsA:'0', PointsB:'0', MatchLive:'FALSE',
    StreamURL:'https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&mute=1&rel=0',
  };
  const fields = ['TeamA','TeamAShort','PlayersA','TeamB','TeamBShort','PlayersB','Tournament','Round','RoundShort','Court','StreamURL'];
  fields.forEach(f => { const inp = document.getElementById('inp_'+f); if(inp) inp.value = matchData[f]||''; });
  standingsData = [
    {name:'Thunder Smash',played:'8',wins:'7',losses:'1',points:'21',setDiff:'12',playing:true},
    {name:'Neon Volley',played:'8',wins:'6',losses:'2',points:'18',setDiff:'8',playing:true},
    {name:'Blaze Drive',played:'8',wins:'5',losses:'3',points:'15',setDiff:'5',playing:false},
    {name:'Shadow Lob',played:'8',wins:'4',losses:'4',points:'12',setDiff:'1',playing:false},
  ];
  renderStandingsEditor();
  updatePointsDisplay();
  updateGamesDisplay();
  updateTeamLabels();
}

/* ============================================================
   SCORE CONTROLS
   ============================================================ */
const PP = ADMIN_CFG.PADEL_POINTS;

function adjScore(key, delta) {
  // Prevent double tap
  const now = Date.now();
  if (adjScore._last && now - adjScore._last < 250) return;
  adjScore._last = now;

  let idx = PP.indexOf(matchData[key] || '0');
  if (idx < 0) idx = 0;
  idx = Math.max(0, Math.min(PP.length - 1, idx + delta));
  matchData[key] = PP[idx];
  updatePointsDisplay();
  saveMatchData();
}

function resetPoints() {
  matchData.PointsA = '0';
  matchData.PointsB = '0';
  updatePointsDisplay();
  saveMatchData();
}

function updatePointsDisplay() {
  document.getElementById('adm_PointsA').textContent = matchData.PointsA || '0';
  document.getElementById('adm_PointsB').textContent = matchData.PointsB || '0';
}

function selectSet(n) {
  currentSet = n;
  document.getElementById('currentSetLabel').textContent = 'Set ' + n;
  [1,2,3].forEach(i => {
    const b = document.getElementById('sBtn'+i);
    if (i === n) { b.style.borderColor = 'var(--cyan)'; b.style.background = 'rgba(0,229,255,0.12)'; }
    else { b.style.borderColor = ''; b.style.background = ''; }
  });
  updateGamesDisplay();
}

function adjGame(team, delta) {
  const now = Date.now();
  if (adjGame._last && now - adjGame._last < 250) return;
  adjGame._last = now;

  const key = `Set${currentSet}${team}`;
  let val = parseInt(matchData[key]) || 0;
  val = Math.max(0, val + delta);
  matchData[key] = String(val);
  updateGamesDisplay();
  saveMatchData();
}

function updateGamesDisplay() {
  const ga = matchData[`Set${currentSet}A`];
  const gb = matchData[`Set${currentSet}B`];
  document.getElementById('adm_GameA').textContent = (ga !== undefined && ga !== '-') ? ga : '0';
  document.getElementById('adm_GameB').textContent = (gb !== undefined && gb !== '-') ? gb : '0';
}

function updateTeamLabels() {
  const a = matchData.TeamAShort || (matchData.TeamA||'A').substring(0,3);
  const b = matchData.TeamBShort || (matchData.TeamB||'B').substring(0,3);
  document.getElementById('ptLabelA').textContent = a;
  document.getElementById('ptLabelB').textContent = b;
  document.getElementById('gmLabelA').textContent = a;
  document.getElementById('gmLabelB').textContent = b;
}

/* ============================================================
   MATCH ACTIONS
   ============================================================ */
function setMatchLive(live) {
  matchData.MatchLive = live ? 'TRUE' : 'FALSE';
  showToast(live ? 'Match is LIVE!' : 'Match ended', live ? 'success' : 'error');
  saveMatchData();
}

function resetMatch() {
  if (!confirm('Reset ALL scores to zero? This cannot be undone.')) return;
  matchData.Set1A = '0'; matchData.Set1B = '0';
  matchData.Set2A = '-'; matchData.Set2B = '-';
  matchData.Set3A = '-'; matchData.Set3B = '-';
  matchData.PointsA = '0'; matchData.PointsB = '0';
  currentSet = 1; selectSet(1);
  updatePointsDisplay(); updateGamesDisplay();
  saveMatchData();
  showToast('Match reset to zero', 'success');
}

/* ============================================================
   SAVE MATCH DATA
   ============================================================ */
function saveMatchData() {
  const rows = Object.entries(matchData).map(([k,v]) => [k, v]);
  writeSheet(ADMIN_CFG.MATCH_SHEET, rows);
}

function saveMatchInfo() {
  const fields = ['TeamA','TeamAShort','PlayersA','TeamB','TeamBShort','PlayersB','Tournament','Round','RoundShort','Court'];
  fields.forEach(f => {
    const inp = document.getElementById('inp_'+f);
    if (inp) matchData[f] = inp.value;
  });
  updateTeamLabels();
  saveMatchData();
}

function saveStreamURL() {
  matchData.StreamURL = document.getElementById('inp_StreamURL').value;
  saveMatchData();
}

/* ============================================================
   STANDINGS EDITOR
   ============================================================ */
function renderStandingsEditor() {
  const el = document.getElementById('standingsEditor');
  el.innerHTML = standingsData.map((t, i) =>
    `<div class="standings-edit-row" data-idx="${i}">
      <input class="se-input name-input" value="${t.name}" data-field="name" data-idx="${i}">
      <input class="se-input" type="number" value="${t.played}" data-field="played" data-idx="${i}">
      <input class="se-input" type="number" value="${t.wins}" data-field="wins" data-idx="${i}">
      <input class="se-input" type="number" value="${t.losses}" data-field="losses" data-idx="${i}">
      <input class="se-input" type="number" value="${t.points}" data-field="points" data-idx="${i}">
      <input class="se-input" type="number" value="${t.setDiff}" data-field="setDiff" data-idx="${i}">
      <input class="se-check" type="checkbox" ${t.playing?'checked':''} data-field="playing" data-idx="${i}">
    </div>`
  ).join('');

  // Bind changes
  el.querySelectorAll('.se-input, .se-check').forEach(inp => {
    inp.addEventListener('change', () => {
      const idx = parseInt(inp.dataset.idx);
      const field = inp.dataset.field;
      if (field === 'playing') standingsData[idx][field] = inp.checked;
      else standingsData[idx][field] = inp.value;
    });
  });
}

function addStandingsRow() {
  standingsData.push({ name:'New Team', played:'0', wins:'0', losses:'0', points:'0', setDiff:'0', playing:false });
  renderStandingsEditor();
}

function saveStandings() {
  // Collect latest from DOM
  document.querySelectorAll('.standings-edit-row').forEach((row, i) => {
    row.querySelectorAll('.se-input').forEach(inp => { standingsData[i][inp.dataset.field] = inp.value; });
    row.querySelectorAll('.se-check').forEach(chk => { standingsData[i][chk.dataset.field] = chk.checked; });
  });

  const header = ['Team','Played','Wins','Losses','Points','SetDiff','Playing'];
  const rows = [header, ...standingsData.map(t => [
    t.name, t.played, t.wins, t.losses, t.points, t.setDiff, t.playing ? 'TRUE' : 'FALSE'
  ])];
  writeSheet(ADMIN_CFG.STANDINGS_SHEET, rows);
}

/* ============================================================
   UI HELPERS
   ============================================================ */
function setStatus(type, text) {
  const dot = document.getElementById('statusDot');
  const txt = document.getElementById('statusText');
  dot.className = 'status-dot' + (type === 'saving' ? ' saving' : type === 'error' ? ' error' : '');
  txt.textContent = text;
}

function showToast(msg, type) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + type + ' show';
  setTimeout(() => t.classList.remove('show'), 2500);
}

/* ============================================================
   INIT
   ============================================================ */
document.addEventListener('DOMContentLoaded', () => {
  selectSet(1);
  if (!isLoggedIn) document.getElementById('loginPassword').focus();
});
</script>
</body>
</html>
